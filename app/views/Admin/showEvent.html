#{extends 'admin.html' /}
#{set title:'www.java.no' /}

<script type="text/javascript">
    $(function() {


    #{if event}
    var lectureholders = ${models.LectureHolder.toJSON().raw()};
        $( "#lectureholderAC" ).autocomplete({
            source: lectureholders,
            select: function (event, ui) {$("#lectureHolderId").val(ui.item.id);
        }
    });
    #{/if}



    $( "#event_date" ).datepicker({ dateFormat: 'dd.mm.yy' });
    $( "#published" ).buttonset();
    $( "#checklist" ).buttonset();

    });
</script>
#{form id:'eventForm', action:@Admin.saveEvent(event?.id)}

#{if !event}
<div class="grid_4 prefix_10 suffix_0">
	<a href="javascript:" onclick="$('#eventForm').submit()" class="awesome">Opprett</a>
</div>

#{/if}


#{if event}
<div class="grid_4 prefix_9 suffix_0">
    <a href="" class="awesome" style="background-color:red;color:black"
       onclick="return confirm('Er du sikker på at du vil slette møtet?')">Slett</a> <a href="javascript:" onclick="$('#eventForm').submit()"
                                                                                        class="awesome">Oppdater</a>
</div>

<div class="grid_4">
    <br>

    <h3>Status</h3>
    <hr>
    <div id="published" style="float:left">
        <input type="radio" id="radio1" name="event.published"  value="false" ${!event?.published ? 'checked' : ''} /><label for="radio1">Møtet er ikke publisert</label>
        <input type="radio" id="radio2" name="event.published"  value="true" ${event?.published ? 'checked' : ''}/><label for="radio2">Møtet er publisert</label>
    </div>

    <br>

</div>

<div class="grid_3">
    <br>

    <h3>Todo</h3>
    <hr>
        <pre style="font-size:10pt">
Mat er bestilt        <input type="checkbox" id="event.orderedFood" name="event.orderedFood" value="true" ${event?.orderedFood ? 'checked' : ''} />
Lokalet er bestilt    <input type="checkbox" id="event.bookedPlace" name="event.bookedPlace" value="true" ${event?.bookedPlace ? 'checked' : ''} />
Twitter er skrevet    <input type="checkbox" id="event.writtenTwitter" name="event.writtenTwitter" value="true" ${event?.writtenTwitter ? 'checked' : ''} />
Har sendt møtemail    <input type="checkbox" id="event.sentEMail" name="event.sentOutEMail" value="true" ${event?.sentOutEMail ? 'checked' : ''} />
Vin til foreleser(e)  <input type="checkbox" id="event.boughtWine" name="event.boughtWine" value="true" ${event?.boughtWine ? 'checked' : ''}>
       </pre>
</div>

<div class="grid_4">
    <br>

    <h3>Notater</h3>
    <hr>
    <textarea rows="4" cols="35" name="${event.notepad}">${event.notepad}</textarea>
</div>


<div class="clear"></div>

#{/if}


<div class="grid_7">
    <br>

    <h3>Møtet</h3>
    <hr>

    <input type="hidden" name="event.id" value="${event?.id}"/>

    #{field 'event.region'}
    <div class="field">
        <label for="${field.id}">Region : </label>
        #{select name:'event.region', items:models.Event.Region, value:event?.region /}
        <span class="error">${field.error}</span>
    </div>
    #{/field}


    #{field 'event.date'}
    <div class="field">
        <label for="${field.id}">Dato : </label>
        <input id="${field.id}" type="text" name="${field.name}" size="15"
               value="${field?.value?.format('dd.MM.yyyy')}"/>
        <span class="error">${field.error}</span>
    </div>
    #{/field}

    #{field 'event.location'}
    <div class="field">
        <label for="${field.id}">Møtested : </label>
        <input id="${field.id}" type="text" name="${field.name}" size="30" value="${field.value}"
               class="${field.errorClass}"/>

        <a href="javascript:" onclick="$('#map').dialog({
        modal: true,
        resizable: false,
        width : 625,
        height : 625
        })">
            <img src="/public/images/map.png" alt="kart" class="map"/>
        </a>
        <span class="error">${field.error}</span>
    </div>
    #{/field}


    #{field 'event.title'}
    <div class="field">
        <label for="${field.id}">Tittel på foredraget : </label>
        <input id="${field.id}" type="text" name="${field.name}" size="30" value="${field.value}"
               class="${field.errorClass}"/>
        <span class="error">${field.error}</span>
    </div>
    #{/field}


    #{field 'event.description'}
    <div class="field">
        <label for="${field.id}">Beskrivelse : </label>
        <textarea id="${field.id}" type="text" name="${field.name}" rows="5" cols="48" class="${field.errorClass}">${field.value}</textarea>
        <span class="error">${field.error}</span>
    </div>
    #{/field}
    <br>
    #{/form}

</div>
#{if event}
<div class="grid_4">
    <br>
    <h3>Foreleser(e)<a href="javascript:" class="awesome" onclick="$('#addLectureholder').dialog({
        modal: true,
        resizable: false,
        width : 300,
        height : 200,
        buttons: {
                    'Legg til foreleser': function() {
                        $.post('@{addLectureHolder()}', {eventId : ${event?.id}, lectureholderId: $('#lectureHolderId').val()}, function(data){
                             $( '#lectureholderTable tbody' ).append('<tr><td>espen</td><td><a href=/'javascript:/' class=/'awesome/'>-</a></td></tr>');
                        });
                        $( this ).dialog( 'close' );
                    }
				}
	    });">+</a></h3>
    <hr>
    #{if event && event.lectureholders?.size() == 0}
    Så langt ingen forelesere registrert på dette møtet.
    #{/if}

    <table id="lectureholderTable" width="100%">
        <tbody>
        #{list items:event?.lectureholders, as:'lectureholder'}
            <tr>
                <td>${lectureholder?.fullName}</td>
                <td><a href="javascript:" class="awesome">-</a></td>
            </tr>
        #{/list}
        </tbody>
    </table>




</div>
<div class="clear"></div>



<div class="grid_11">
    <br>

    <h3>Deltager(e) : ${event?.participantCount}<a href="javascript:" class="awesome" onclick="$('#addParticipant').dialog({
        modal: true,
        resizable: false,
        width : 300,
        height : 100
        })">+</a></h3>
    <hr>
    #{list items:event?.participants, as:'participant'}
    ${participant?.name} (${participant?.email})<br>
    #{/list}
</div>
#{/if}


<div id="map" title="Her skal vi møtes" style="display:none">
    <iframe id="googlemap" name="googlemap" width="595" height="560" frameborder="0" scrolling="no" marginheight="0"
            marginwidth="0" src="http://maps.google.no/?q=${event?.location}&amp;ie=UTF8&amp;output=embed"></iframe>
</div>

<div id="addLectureholder" title="Legg til foreleser" style="display:none">
    <label>Navn</label><input size="30" id="lectureholderAC"/>
	<input type="hidden" name="lectureHolderId" id="lectureHolderId" value="">
</div>

<div id="addParticipant" title="Legg til deltager" style="display:none">
    Navn : <input type="text"/><br>
    Epost : <input type="text"/>
</div>